# Pixel Dungeon 프로젝트 가이드라인

## 최우선 규칙: Agent Swarm 자동 적용

**모든 개발 요청은 사용자 확인 후 Agent Swarm으로 처리**

### 트리거 조건

다음 키워드가 포함된 요청에 자동 적용:
- 분석, 개선, 개발, 구현, 추가, 수정, 버그, 기능
- 리팩토링, 최적화, 변경, 삭제, 생성
- fix, feature, implement, refactor, optimize, add, update, create

### 제외 조건

- 슬래시 명령어 (`/new-feature`, `/bugfix` 등)
- 단순 질문 ("~가 뭐야?", "~는 어디에 있어?")
- 문서/설명 요청 ("설명해줘", "알려줘")

### 필수 절차: 3단계 확인 워크플로우 (IPE)

**Interpret → Present → Execute** 패턴으로 모호한 요청도 정확하게 처리합니다.

```
┌─────────────────────────────────────────────────────────────────┐
│  1. 해석 (Interpret)                                             │
│                                                                  │
│     사용자: "새로운 몬스터 추가해줘"                               │
│                    ↓                                             │
│     AI: Explore Agent로 컨텍스트 수집                            │
│         - 기존 Monster 클래스 구조 분석                           │
│         - 스프라이트/에셋 확인                                    │
│         - BattleSystem 연동 방식 파악                            │
│                                                                  │
│     ⚠️ 이 단계에서는 코드 수정 금지, 분석만 수행                   │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│  2. 제시 (Present)                                               │
│                                                                  │
│     📋 요청 해석 결과                                             │
│     ├─ 현재 구조:                                                │
│     │   • Monster 클래스 분석 결과                                │
│     │   • 필요한 에셋 목록                                        │
│     │                                                            │
│     ├─ 제안 작업:                                                │
│     │   1. [높음] Monster 서브클래스 생성                         │
│     │   2. [중간] 스프라이트 에셋 생성                            │
│     │   3. [낮음] BattleScene 연동                               │
│     │                                                            │
│     └─ 예상 결과: 새 몬스터 타입 추가                             │
│                                                                  │
│     사용자 선택 요청 (AskUserQuestion)                           │
└─────────────────────┬───────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────┐
│  3. 실행 (Execute)                                               │
│                                                                  │
│     사용자 승인 후 GAPEVI 사이클 실행                             │
└─────────────────────────────────────────────────────────────────┘
```

---

## 프로젝트 정보

- **타입**: 픽셀 아트 던전 RPG 게임
- **엔진**: Phaser 3.90
- **언어**: TypeScript 5.9
- **빌드**: Vite 7
- **해상도**: 480x320 (픽셀 아트)
- **물리 엔진**: Arcade Physics

---

## 프로젝트 구조

```
pixel-dungeon/
├── src/
│   ├── main.ts              # 게임 진입점
│   ├── config.ts            # Phaser 게임 설정
│   ├── entities/            # 게임 엔티티
│   │   ├── Player.ts        # 플레이어 캐릭터
│   │   ├── Monster.ts       # 몬스터 기본 클래스
│   │   └── NPC.ts           # NPC 캐릭터
│   ├── scenes/              # Phaser 씬
│   │   ├── BootScene.ts     # 초기화 씬
│   │   ├── PreloadScene.ts  # 에셋 로딩 씬
│   │   ├── MenuScene.ts     # 메인 메뉴
│   │   ├── GameScene.ts     # 메인 게임플레이
│   │   └── BattleScene.ts   # 전투 씬
│   ├── systems/             # 게임 시스템
│   │   ├── InputController.ts  # 입력 처리
│   │   └── BattleSystem.ts     # 전투 로직
│   ├── ui/                  # UI 컴포넌트
│   │   ├── HealthBar.ts     # 체력바
│   │   ├── DialogBox.ts     # 대화창
│   │   └── BattleUI.ts      # 전투 UI
│   └── types/               # 타입 정의
│       └── index.ts
├── public/                  # 정적 에셋
├── scripts/                 # 에셋 생성 스크립트
│   ├── generate-player.js
│   ├── generate-monster.js
│   ├── generate-npc.js
│   └── generate-tileset.js
├── package.json
├── tsconfig.json
└── index.html
```

---

## 규칙
@./rules/typescript.md
@./rules/phaser.md
@./rules/game-architecture.md
@./rules/testing.md

## 지식 베이스
@./knowledge/conventions.md
@./knowledge/architecture.md
@./knowledge/phaser-patterns.md
@./knowledge/git-workflow.md

---

# 통합 워크플로우 (필수 준수)

## 마스터 워크플로우: GAPEVI 사이클

모든 작업은 다음 6단계 사이클을 따릅니다:

```
┌─────────────────────────────────────────────────────────────────────┐
│                                                                      │
│   ┌──────────┐    ┌──────────┐    ┌──────────┐                      │
│   │  수집    │ → │  분석    │ → │ 우선순위  │                      │
│   │ Gather   │    │ Analyze  │    │ Prioritize│                      │
│   └──────────┘    └──────────┘    └──────────┘                      │
│                                         │                            │
│                                         ▼                            │
│   ┌──────────┐    ┌──────────┐    ┌──────────┐                      │
│   │  반복    │ ← │  검증    │ ← │  실행    │                      │
│   │ Iterate  │    │ Validate │    │ Execute  │                      │
│   └──────────┘    └──────────┘    └──────────┘                      │
│        │                                                             │
│        └─────────────── 필요 시 해당 단계로 복귀 ──────────────────→ │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 단계별 상세

### 1. 수집 (Gather)
**목적**: 작업에 필요한 모든 정보 수집

| 활동 | 설명 |
|------|------|
| 요구사항 수집 | 사용자 요청 명확화 |
| 컨텍스트 수집 | 관련 파일, 코드 탐색 |
| 제약사항 파악 | 기술적 제한, 의존성 확인 |

**에이전트**: Explore (subagent_type="Explore")

### 2. 분석 (Analyze)
**목적**: 수집된 정보 분석 및 접근 방식 결정

**키워드 → 에이전트 매핑**:
| 키워드 | 에이전트 |
|--------|---------|
| Entity, Monster, Player, NPC, 캐릭터 | **Entity** |
| Scene, 씬, 화면, 전환 | **Scene** |
| System, 시스템, 전투, 입력 | **System** |
| UI, HUD, 메뉴, 대화창, 인벤토리 | **UI** |
| 에셋, 스프라이트, 타일셋, 이미지 | **Asset** |
| 테스트, 검증, QA | **Tester** |

### 3. 우선순위 (Prioritize)
**목적**: 작업 분해 및 실행 순서 결정

**작업 상태**:
- `[ ]` 대기 (Pending)
- `[~]` 진행중 (In Progress)
- `[x]` 완료 (Done)
- `[!]` 차단됨 (Blocked)

### 4. 실행 (Execute)
**목적**: 계획된 작업 구현

**게임 개발 순서**:
```
1. 타입 정의 (types/)
2. 엔티티 구현 (entities/)
3. 시스템 구현 (systems/)
4. 씬 통합 (scenes/)
5. UI 연결 (ui/)
```

### 5. 검증 (Validate)
**목적**: 구현 결과 검증

**Quality Gate** (모든 항목 통과 필수):
```
┌─────────────────────────────────────────────────────────┐
│                     Quality Gate                         │
├─────────────────────────────────────────────────────────┤
│  1. 타입 체크         tsc --noEmit                       │
│  2. 린트 (ESLint)     npx eslint src/ (설정 시)          │
│  3. 빌드 (Vite)       npm run build                      │
│  4. 게임 실행 테스트   npm run dev → 브라우저 확인        │
└─────────────────────────────────────────────────────────┘
```

### 6. 반복 (Iterate)
**목적**: 검증 결과에 따른 개선

| 상황 | 복귀 단계 |
|------|----------|
| 타입 오류 | → 실행 (Execute) |
| 빌드 실패 | → 실행 (Execute) |
| 요구사항 변경 | → 분석 (Analyze) |
| 새 정보 발견 | → 수집 (Gather) |

### 7. 완료 후 Next Step (필수)

모든 작업 완료 후 **반드시** 다음을 제안하세요:

```markdown
## Next Step 제안

### 📊 작업 완료 요약
| 항목 | 내용 |
|------|------|
| 작업 유형 | [새 기능 / 버그 수정 / 리팩토링] |
| 변경 파일 | [N개 파일] |
| Quality Gate | ✅ 통과 / ⚠️ 경고 / ❌ 실패 |

### 🔧 추가 개선 사항
| 우선순위 | 항목 | 이유 |
|---------|------|------|
| 높음 | [개선 항목] | [필요한 이유] |
| 중간 | [개선 항목] | [필요한 이유] |

### ✅ 다음 액션 체크리스트
- [ ] 게임 실행 테스트
- [ ] 새 기능 동작 확인
```

---

## 명령어

### 개발 (전체 GAPEVI 사이클)
- `/new-feature` - 새 기능 개발
- `/bugfix` - 버그 수정

### 부분 실행
- `/build` - 빌드 (tsc && vite build)
- `/dev` - 개발 서버 실행
- `/validate` - 타입 체크 및 빌드 검증

### 에셋
- `/generate-sprite` - 스프라이트 생성 스크립트 실행
- `/generate-tileset` - 타일셋 생성

---

## 변경 이력

| 날짜 | 변경 | 담당자 |
|------|------|--------|
| 2026-02-03 | 초기 생성 (blog.shaul.kr에서 마이그레이션) | @claude |
